<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Burger House Admin</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {
    background: #fff8f0;
    font-family: 'Arial', sans-serif;
  }
  h1 {
    text-align: center;
    margin: 20px 0;
    color: #d62828;
  }
</style>
</head>
<body>

<h1>ðŸ”‘ Admin Panel</h1>

<div class="container">
  <form id="addItemForm" class="mb-4">
    <div class="mb-2">
      <label for="name" class="form-label">Naziv</label>
      <input type="text" class="form-control" id="name" required>
    </div>
    <div class="mb-2">
      <label for="desc" class="form-label">Opis</label>
      <input type="text" class="form-control" id="desc" required>
    </div>
    <div class="mb-2">
      <label for="price" class="form-label">Cena (RSD)</label>
      <input type="number" class="form-control" id="price" required>
    </div>
    <div class="mb-2">
      <label class="form-label">Kategorija</label>
      <select id="category" class="form-select">
        <option value="food">Hrana</option>
        <option value="drinks">PiÄ‡e</option>
      </select>
    </div>
    <div class="mb-2">
      <label class="form-label">Slika</label>
      <input type="file" id="fileInput" class="form-control">
    </div>
    <button type="submit" class="btn btn-danger mt-2">Dodaj item</button>
  </form>

  <h3>Lista svih itema</h3>
  <div id="itemsList"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://upload-widget.cloudinary.com/global/all.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDqI-XnDj1zRNKweGg6yiRKAf8J8kgRrQo",
    authDomain: "burger-house-ab51a.firebaseapp.com",
    projectId: "burger-house-ab51a",
    storageBucket: "burger-house-ab51a.appspot.com",
    messagingSenderId: "31759588920",
    appId: "1:31759588920:web:cbe71c854f3885073d50cd"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

// --- Login ---
  const loginForm = document.getElementById("loginForm");
  const logoutBtn = document.getElementById("logoutBtn");
  const addForm = document.getElementById("addForm");

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    try {
      await auth.signInWithEmailAndPassword(email, pass);
    } catch (err) {
      alert("GreÅ¡ka pri logovanju: " + err.message);
    }
  });

  logoutBtn.addEventListener("click", () => auth.signOut());

  auth.onAuthStateChanged(user => {
    if (user) {
      loginForm.style.display = "none";
      logoutBtn.style.display = "block";
      addForm.style.display = "block";
      loadItems();
    } else {
      loginForm.style.display = "block";
      logoutBtn.style.display = "none";
      addForm.style.display = "none";
      document.getElementById("itemsList").innerHTML = "";
    }
  });

  
  // Cloudinary widget
  let uploadedImageURL = "";
  const myWidget = cloudinary.createUploadWidget({
    cloudName: 'djnbsbare', // ubaci svoj cloud name
    uploadPreset: 'burgerhouse_admin' // ubaci svoj upload preset
  }, (error, result) => {
    if (!error && result && result.event === "success") {
      uploadedImageURL = result.info.secure_url;
      console.log("Slika uploadovana:", uploadedImageURL);
    }
  });

  document.getElementById("fileInput").addEventListener("click", function(){
      myWidget.open();
  }, false);

  // Dodaj item
  document.getElementById("addItemForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value;
    const desc = document.getElementById("desc").value;
    const price = document.getElementById("price").value;
    const category = document.getElementById("category").value;

    if(!uploadedImageURL){
      alert("Uploaduj sliku pre dodavanja!");
      return;
    }

    await db.collection(category).add({
      name, desc, price, image: uploadedImageURL
    });

    alert("Item dodat!");
    document.getElementById("addItemForm").reset();
    uploadedImageURL = "";
    loadItems();
  });

  // Prikaz svih itema
  async function loadItems() {
    let html = '';
    const categories = ["food", "drinks"];
    for(const cat of categories){
      const snapshot = await db.collection(cat).get();
      snapshot.forEach(doc => {
        const data = doc.data();
        html += `
          <div class="card mb-2 p-2">
            <strong>${data.name}</strong> (${cat}) - ${data.price} RSD
            <button class="btn btn-sm btn-danger float-end" onclick="deleteItem('${cat}','${doc.id}')">ObriÅ¡i</button>
          </div>
        `;
      });
    }
    document.getElementById("itemsList").innerHTML = html;
  }

  async function deleteItem(cat, id){
    if(confirm("Da li ste sigurni?")){
      await db.collection(cat).doc(id).delete();
      loadItems();
    }
  }

  loadItems();
</script>

</body>
</html>

